{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planets</title>
<link rel="stylesheet" href="{% static 'planets/style-orbits.css' %}">
  <link rel="stylesheet" href="{% static 'planets/colors.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  /* Left events panel: symmetric to date panel on the right */
  .left-events-panel {
    --events-gap: 60px;          /* space from Solar System frame */
    --events-left-margin: 24px;  /* minimum space from page left edge */
    position: absolute;
    top: 15%;
    right: calc(50% + min(30vw, 430px) + var(--events-gap));
    transform: none;
    z-index: 1150;
    width: clamp(140px, calc(50vw - min(30vw, 430px) - var(--events-gap) - var(--events-left-margin)), 320px);
    height: fit-content;
    max-height: calc(100vh - 24px);
  }
  .left-events-panel .win-content {
    padding: 16px 20px;
    overflow-y: auto;
    max-height: calc(100vh - 24px - 40px);
  }
  .events-content {
    font-size: 0.8rem;
    line-height: 1.4;
    overflow-wrap: break-word;
    word-break: break-word;
  }
  .ev-row {
    margin-bottom: 2px;
  }
  /* Label color (before colon) */
  .ev-label {
    color: var(--color-4); /* #6fa341 */
    font-weight: 600;
  }
  /* Value color (after colon) */
  .ev-value {
    color: #cad670; /* requested value color */
  }
  .ev-note {
    font-size: 0.7rem;
    color: var(--muted);
    margin-top: 2px;
  }
  .ev-planet-list {
    margin: 4px 0 0 16px;
    padding: 0;
    list-style: disc;
    font-size: 0.8rem;
    line-height: 1.3;
  }
  .events-content hr {
    border: none;
    border-top: 1px solid var(--color-7);
    margin: 8px 0;
  }
</style>

</head>
<body>

<main>
  <div class="solar-frame win-window" role="group" aria-label="Solar System">
    <div class="win-inner">
      <div class="win-titlebar" aria-hidden="true">
        <div class="win-title">Solar System</div>
        <div class="win-controls">
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">_</button>
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">□</button>
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">×</button>
        </div>
      </div>

      <div class="win-content solar-box">
        <svg viewBox="0 0 1600 1600" class="solar-system" xmlns:xlink="http://www.w3.org/1999/xlink">
        <!-- Solar system background -->
        <image
          id="background"
          href="{% static 'planets/gifs/fondo.png' %}"
          xlink:href="{% static 'planets/gifs/fondo.png' %}"
          x="0" y="0"
          width="1600" height="1600"
          preserveAspectRatio="xMidYMid slice"
        ></image>
        <!-- Sol (GIF) -->
        <image
          id="sun"
          href="{% static 'planets/gifs/sun.gif' %}"
          xlink:href="{% static 'planets/gifs/sun.gif' %}"
          data-name="Sun"
          x="710" y="710"
          width="180" height="180"
          preserveAspectRatio="xMidYMid meet"
        ></image>

        <!-- Planet orbits (generated from radii_list) -->
        {% for r in radii_list %}
          <circle class="orbit" cx="800" cy="800" r="{{ r }}" fill="none"></circle>
        {% endfor %}

        <!-- Asteroid belt (points generated by JS) -->
        <g id="asteroid-belt"></g>

        <!-- Planets (GIF/PNG) -->
        <image id="mercury" href="{% static 'planets/gifs/mercury.gif' %}" xlink:href="{% static 'planets/gifs/mercury.gif' %}" width="30" height="30" preserveAspectRatio="xMidYMid meet" data-name="Mercury"></image>
        <image id="venus" href="{% static 'planets/gifs/venus.gif' %}" xlink:href="{% static 'planets/gifs/venus.gif' %}" width="35" height="35" preserveAspectRatio="xMidYMid meet" data-name="Venus"></image>
        <image id="earth" href="{% static 'planets/gifs/earth.gif' %}" xlink:href="{% static 'planets/gifs/earth.gif' %}" width="40" height="40" preserveAspectRatio="xMidYMid meet" data-name="Earth"></image>
        <image id="mars" href="{% static 'planets/gifs/mars.gif' %}" xlink:href="{% static 'planets/gifs/mars.gif' %}" width="35" height="35" preserveAspectRatio="xMidYMid meet" data-name="Mars"></image>
        <image id="jupiter" href="{% static 'planets/gifs/jupiter.gif' %}" xlink:href="{% static 'planets/gifs/jupiter.gif' %}" width="80" height="80" preserveAspectRatio="xMidYMid meet" data-name="Jupiter"></image>
        <image id="saturn" href="{% static 'planets/gifs/saturn.gif' %}" xlink:href="{% static 'planets/gifs/saturn.gif' %}" width="120" height="120" preserveAspectRatio="xMidYMid meet" data-name="Saturn"></image>
        <image id="uranus" href="{% static 'planets/gifs/uranus.gif' %}" xlink:href="{% static 'planets/gifs/uranus.gif' %}" width="60" height="60" preserveAspectRatio="xMidYMid meet" data-name="Uranus"></image>
        <image id="neptune" href="{% static 'planets/gifs/neptune.gif' %}" xlink:href="{% static 'planets/gifs/neptune.gif' %}" width="60" height="60" preserveAspectRatio="xMidYMid meet" data-name="Neptune"></image>
        </svg>

        <!-- Tooltip for planet names -->
        <div id="planet-tooltip" class="planet-tooltip"></div>
      </div>
    </div>
  </div>

  <!-- Date picker panel -->
  <div class="date-control-panel win-window" role="group" aria-label="Date">
    <div class="win-inner">
      <div class="win-titlebar" aria-hidden="true">
        <div class="win-title">Date</div>
        <div class="win-controls">
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">_</button>
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">□</button>
          <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">×</button>
        </div>
      </div>

      <div class="win-content">
        <form method="get" id="date-form">
          <div class="form-group">
            <div class="date-input-wrap">
              <input type="text" id="date" name="date" value="{{ selected_date }}" class="date-input" placeholder="YYYY-MM-DD">
              <button type="button" id="calendar-btn" class="btn calendar-btn" aria-label="Open calendar">
                <img src="{% static 'planets/imgs/calendar.png' %}" alt="Calendar" class="pixel-icon">
              </button>
              <!-- Container for the custom datepicker -->
              <div id="custom-datepicker" class="custom-datepicker" aria-hidden="true"></div>
            </div>
          </div>

          <!-- Date navigation: previous / today / next -->
          <div class="date-nav-row">
            <button type="button" id="prev-day-btn" class="btn btn-nav" aria-label="Previous day">◀</button>
            <button type="button" id="today-btn" class="btn btn-today" aria-label="Today">Today</button>
            <button type="button" id="next-day-btn" class="btn btn-nav" aria-label="Next day">▶</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Left events panel (symmetric to date panel) -->
  <aside id="left-events-panel" class="win-window left-events-panel">
    <div class="win-inner">
      <div class="win-titlebar" aria-hidden="true">
        <div class="win-title">Upcoming Events</div>
        <div class="win-controls"><button type="button" class="win-btn" tabindex="-1" aria-hidden="true">_</button><button type="button" class="win-btn" tabindex="-1" aria-hidden="true">□</button><button type="button" class="win-btn" tabindex="-1" aria-hidden="true">×</button></div>
      </div>
      <div class="win-content">
        <div class="events-content">
          <div class="ev-row"><span class="ev-label">Next eclipse:</span> <span class="ev-value">{% if upcoming_events.eclipse.date %}<span class="no-wrap">{{ upcoming_events.eclipse.date }}</span> — {{ upcoming_events.eclipse.type }}{% else %}<em>Not calculated</em>{% endif %}</span></div>
          {% if upcoming_events.eclipse.note %}<div class="ev-note">{{ upcoming_events.eclipse.note }}</div>{% endif %}

          <hr>
          <div class="ev-row"><span class="ev-label">Meteor shower:</span> <span class="ev-value">{% if upcoming_events.meteor_shower %}{{ upcoming_events.meteor_shower.name }} — <span class="no-wrap">{{ upcoming_events.meteor_shower.date }}</span>{% else %}<em>None upcoming</em>{% endif %}</span></div>

          <hr>
          <div class="ev-row"><span class="ev-label">Next visible comet:</span> <span class="ev-value">{% if upcoming_events.comet.name %}{{ upcoming_events.comet.name }}{% else %}<em>No comet data available</em>{% endif %}</span></div>
          {% if upcoming_events.comet.estimated_mag %}<div class="ev-row"><span class="ev-label">Est. magnitude:</span> <span class="ev-value">{{ upcoming_events.comet.estimated_mag }}</span></div>{% endif %}
          {% if upcoming_events.comet.elongation_deg %}<div class="ev-row"><span class="ev-label">Elongation:</span> <span class="ev-value">{{ upcoming_events.comet.elongation_deg }}°</span></div>{% endif %}

          <hr>
          <div class="ev-row"><span class="ev-label">Visible planets (≥30°):</span></div>
          {% if upcoming_events.visible_planets and upcoming_events.visible_planets|length > 0 %}
            <ul class="ev-planet-list">
              {% for p in upcoming_events.visible_planets %}
                <li><span class="ev-label">{{ p.planet|capfirst }}:</span> <span class="ev-value">{{ p.elongation_deg }}°</span></li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="ev-value"><em>None identified</em></div>
          {% endif %}
        </div>
      </div>
    </div>
  </aside>
</main>

      <!-- Moon phase panel (below date panel) -->
      <div id="moon-panel" class="moon-panel win-window" role="group" aria-label="Moon Phase">
        <div class="win-inner">
          <div class="win-titlebar" aria-hidden="true">
            <div class="win-title">Moon Phase</div>
            <div class="win-controls">
              <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">_</button>
              <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">□</button>
              <button type="button" class="win-btn" tabindex="-1" aria-hidden="true">×</button>
            </div>
          </div>
          <div class="win-content">
            <div class="moon-content">
              <img id="moon-phase-img" src="{% static 'planets/imgs/moon/new_moon.png' %}" alt="Moon phase" class="moon-img">
              <div id="moon-phase-label" class="moon-label">New Moon</div>
            </div>
          </div>
        </div>
      </div>

<!-- Planet info popup -->
<div id="planet-modal-overlay" class="planet-modal-overlay" hidden>
  <div id="planet-modal" class="win-window planet-modal" role="dialog" aria-modal="true" aria-labelledby="planet-modal-title">
    <div class="win-inner">
      <div class="win-titlebar">
        <div class="win-title" id="planet-modal-title">Planet</div>
        <div class="win-controls">
          <button type="button" id="planet-modal-close" class="win-btn planet-modal-close" aria-label="Close">×</button>
        </div>
      </div>
      <div class="win-content">
        <div id="planet-modal-body" class="planet-modal-body"></div>
      </div>
    </div>
  </div>
</div>

<!-- Data for JS -->
<script id="planet-info-data" type="application/json">
{
  "sun": {"title": "Sun", "notes": ""},
  "mercury": {"title": "Mercury", "notes": "Write your notes about Mercury here."},
  "venus": {"title": "Venus", "notes": "Write your notes about Venus here."},
  "earth": {"title": "Earth", "notes": "Write your notes about Earth here."},
  "mars": {"title": "Mars", "notes": "Write your notes about Mars here."},
  "jupiter": {"title": "Jupiter", "notes": "Write your notes about Jupiter here."},
  "saturn": {"title": "Saturn", "notes": "Write your notes about Saturn here."},
  "uranus": {"title": "Uranus", "notes": "Write your notes about Uranus here."},
  "neptune": {"title": "Neptune", "notes": "Write your notes about Neptune here."}
}
</script>
<script id="positions-data" type="application/json">{{ positions_json|safe }}</script>
<script id="periods-data" type="application/json">{{ periods_json|safe }}</script>

<script src="{% static 'planets/sidebar.js' %}"></script>
<script src="{% static 'planets/orbits.js' %}"></script>

{% load django_browser_reload %}
{% django_browser_reload_script %}

</body>
</html>
